<div id="trustpilot-review-widget" class="trustpilot-plugin-wrapper">
    {% if test_mode %}
        <span class="badge bg-warning text-dark trustpilot-test-badge">TEST MODE</span>
    {% endif %}

    <div class="card shadow-sm h-100 trustpilot-card">
        <div class="card-header trustpilot-card-header">
            <h5 class="card-title mb-0">
                <i class="fas fa-star me-2"></i>{{ popup_title }}
            </h5>
        </div>
        <div class="card-body">
            {% if business_unit_id %}
                <div class="trustpilot-trustbox-wrapper">
                    <script type="text/javascript" src="//widget.trustpilot.com/bootstrap/v5/tp.widget.bootstrap.min.js" async></script>
                    <div class="trustpilot-widget"
                         data-locale="{{ trustbox_locale|default('en-US') }}"
                         data-template-id="{{ trustbox_template_id }}"
                         data-businessunit-id="{{ business_unit_id }}"
                         data-style-height="{{ trustbox_height }}"
                         data-style-width="100%"
                         data-theme="{{ trustbox_theme }}"
                         data-stars="{{ trustbox_stars }}">
                        <a href="https://www.trustpilot.com/review/{{ business_domain }}" target="_blank" rel="noopener noreferrer">Trustpilot</a>
                    </div>
                </div>
            {% else %}
                <p class="text-muted text-center mb-0">
                    <i class="fas fa-exclamation-triangle me-1"></i>
                    TrustBox widget requires a Business Unit ID. Check the plugin settings.
                </p>
            {% endif %}

            {% if popup_message %}
                <p class="card-text mt-3">{{ popup_message }}</p>
            {% endif %}
        </div>

        {% if show_leave_review_button %}
            <div class="card-footer trustpilot-card-footer">
                <div class="d-flex justify-content-between align-items-center">
                    <small class="trustpilot-powered-by">
                        <i class="fas fa-shield-alt me-1"></i>{{ label_powered_by }}
                    </small>
                    <a href="{{ review_url }}" target="_blank" rel="noopener noreferrer" class="btn btn-success btn-sm trustpilot-review-btn">
                        <i class="fas fa-external-link-alt me-1"></i>{{ label_leave_review }}
                    </a>
                </div>
            </div>
        {% endif %}
    </div>
</div>
