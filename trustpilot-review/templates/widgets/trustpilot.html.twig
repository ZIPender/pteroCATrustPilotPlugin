{#
 # Trustpilot Review Widget Template
 #
 # Displays a permanent card showing Trustpilot rating and prompting users to leave a review.
 #}
<div class="card shadow-sm h-100 trustpilot-widget" id="trustpilot-review-widget">
    <div class="card-header bg-success text-white">
        <h5 class="card-title mb-0">
            <i class="fas fa-star me-2"></i>
            {{ popup_title }}
            {% if test_mode %}
            <span class="badge bg-warning text-dark ms-2" style="font-size: 0.6em;">TEST MODE</span>
            {% endif %}
        </h5>
    </div>
    <div class="card-body">
        <div class="trustpilot-rating-container mb-3">
            {% if trustpilot_reviews_count > 0 %}
                <div class="trustpilot-stars" data-rating="{{ trustpilot_score }}">
                    {% for i in 1..5 %}
                        {% if i <= trustpilot_score|round %}
                            <i class="fas fa-star trustpilot-star filled"></i>
                        {% elseif i - 0.5 <= trustpilot_score %}
                            <i class="fas fa-star-half-alt trustpilot-star filled"></i>
                        {% else %}
                            <i class="far fa-star trustpilot-star empty"></i>
                        {% endif %}
                    {% endfor %}
                </div>
                <div class="trustpilot-score-info">
                    <span class="trustpilot-score-value">{{ trustpilot_score|number_format(1) }}</span>
                    <span class="trustpilot-separator">/</span>
                    <span class="trustpilot-score-max">5</span>
                    <span class="trustpilot-reviews-count">
                        ({{ trustpilot_reviews_count }} avis)
                    </span>
                </div>
            {% else %}
                <div class="trustpilot-stars">
                    {% for i in 1..5 %}
                        <i class="far fa-star trustpilot-star empty"></i>
                    {% endfor %}
                </div>
                <div class="trustpilot-no-reviews">
                    Aucun avis pour le moment
                </div>
            {% endif %}
        </div>
        <p class="card-text">{{ popup_message }}</p>
    </div>
    <div class="card-footer bg-light">
        <div class="d-flex justify-content-center">
            <a href="{{ review_url }}" target="_blank" rel="noopener noreferrer" class="btn btn-success trustpilot-review-btn">
                <i class="fas fa-external-link-alt me-2"></i>Laisser un avis
            </a>
        </div>
    </div>
</div>
